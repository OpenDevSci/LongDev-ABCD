"use strict";var g=require("path"),x=require("fs"),E=require("module"),c=require("get-tsconfig"),O=require("../source-map.cjs"),p=require("../index-5f60304b.cjs"),P=require("../resolve-ts-path-43f50656.cjs"),T=require("../node-features-ecef9e7b.cjs");require("source-map-support"),require("url"),require("esbuild"),require("crypto"),require("os");function u(s){return s&&typeof s=="object"&&"default"in s?s:{default:s}}var d=u(g),M=u(x),l=u(E);const q=/^\.{1,2}\//,N=/\.[cm]?tsx?$/,b=`${d.default.sep}node_modules${d.default.sep}`,i=process.env.ESBK_TSCONFIG_PATH?{path:d.default.resolve(process.env.ESBK_TSCONFIG_PATH),config:c.parseTsconfig(process.env.ESBK_TSCONFIG_PATH)}:c.getTsconfig(),h=i&&c.createFilesMatcher(i),F=i&&c.createPathsMatcher(i),S=O.installSourceMapSupport(),f=l.default._extensions,A=f[".js"],R=[".js",".cjs",".cts",".mjs",".mts",".ts",".tsx",".jsx"],j=(s,e)=>{if(!R.some(t=>e.endsWith(t)))return A(s,e);process.send&&process.send({type:"dependency",path:e});let r=M.default.readFileSync(e,"utf8");if(e.endsWith(".cjs")&&T.nodeSupportsImport){const t=p.transformDynamicImport(e,r);t&&(r=S(t,e))}else{const t=p.transformSync(r,e,{tsconfigRaw:h==null?void 0:h(e)});r=S(t,e)}s._compile(r,e)};[".js",".ts",".tsx",".jsx"].forEach(s=>{f[s]=j}),Object.defineProperty(f,".mjs",{value:j,enumerable:!1});const v=l.default._resolveFilename.bind(l.default);l.default._resolveFilename=(s,e,o,r)=>{var t;if(!T.supportsNodePrefix&&s.startsWith("node:")&&(s=s.slice(5)),F&&!q.test(s)&&!((t=e==null?void 0:e.filename)!=null&&t.includes(b))){const a=F(s);for(const m of a){const _=y(m,e,o,r);if(_)return _;try{return v(m,e,o,r)}catch{}}}const n=y(s,e,o,r);return n||v(s,e,o,r)};const y=(s,e,o,r)=>{const t=P.resolveTsPath(s);if(e!=null&&e.filename&&N.test(e.filename)&&t)try{return v(t[0],e,o,r)}catch(n){const{code:a}=n;if(a!=="MODULE_NOT_FOUND"&&a!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw n}};
